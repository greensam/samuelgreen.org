<!DOCTYPE html><html itemscope itemtype="http://schema.org/Article"><head><title>Writing cross-platform Node.js | Shape Shed</title><meta property="og:title" value="Writing cross-platform Node.js | Shape Shed"><meta description="A major strength of Node.js is great cross-platform support. With a little effort you can make sure your code will run on Windows, Linux and OSX."><meta name="twitter:description" value="A major strength of Node.js is great cross-platform support. With a little effort you can make sure your code will run on Windows, Linux and OSX."><meta property="og:description" value="A major strength of Node.js is great cross-platform support. With a little effort you can make sure your code will run on Windows, Linux and OSX."><meta keywords="Node.js"><meta itemprop="keywords" content="Node.js"><meta charset="utf-8"><meta name="author" content="George Ornbo"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="twitter:card" value="summary"><meta name="twitter:title" value="Writing cross-platform Node.js | Shape Shed"><meta name="twitter:site" value="@shapeshed"><meta name="twitter:creator" value="@shapeshed"><meta name="twitter:domain" value="shapeshed.com"><meta property="og:type" value="article"><meta property="og:site_name" value="Shape Shed"><meta itemprop="isFamilyFriendly" content="true"><meta itemprop="inLanguage" content="en-GB"><link rel="stylesheet" href="/stylesheets/application-7c8a1e57cc84fce606a31bcfe30fcb98.css"><link href="/atom.xml" rel="alternate" title="Shape Shed" type="application/atom+xml"><link rel="author" href="https://plus.google.com/u/0/112147367550950112369/posts"><link rel="publisher" href="https://plus.google.com/u/0/112147367550950112369"></head><body><article><p class="date"> <time datetime="2014-03-25T11:53:07.000Z" data-updated="true" itemprop="datePublished">Tuesday, March 25, 2014</time></p><h1 itemprop="headline name">Writing cross-platform Node.js</h1><div itemprop="articleBody"><h2 itemprop="description" class="dropcap">A major strength of Node.js is great cross-platform support. With a little effort you can make sure your code will run on Windows, Linux and OSX.</h2><h2>Cross-platform if you want</h2>
<p>Node.js is cross-platform meaning it works on Windows, OSX and Linux. A large number of the Node.js community write Node.js on OSX and then deploy to Linux servers. Because OSX and Linux are based on UNIX this tends to just work. Windows support is a first-class citizen in Node.js and if you learn to use Node.js in the right way you can make sure that you can welcome your Windows friends to your code party.</p>
<h2>Paths</h2>
<p>The biggest issue you will run into is paths. Node.js does a great job of taking care of most of this for you but if you build paths in the wrong way you&#39;ll run into problems on Windows.</p>
<p>Consider you are doing some string concatantion to build a path for example.</p>
<pre><code>var foo = &#39;foo&#39;;
var bar = &#39;bar&#39;;
var filePath = foo + &#39;/&#39; + bar + &#39;/&#39;;</code></pre>
<p>Whilst forward slashes will work ok on Windows if you do string concatenation you miss out on the protection that the path module in Node.js gives you.</p>
<p>The <a href="http://nodejs.org/api/path.html">path</a> module gives you all of the tools you need to handle cross-platform paths. For this example we need <code>path.join</code>.</p>
<pre><code>var filePath = path.join(foo, bar);
// &#39;foo/bar&#39; on OSX and Linux
// &#39;foo\\bar&#39; on Windows</code></pre>
<h2>Use <code>path.resolve</code> to traverse the filesystem</h2>
<p>Using <code>path.resolve</code> lets you move around the file system but maintain cross platform compatibility. As per the documentation you can think of it as a series of <code>cd</code> commands that output a single path at the end.</p>
<pre><code>path.resolve(&#39;../&#39;, &#39;/../&#39;, &#39;../&#39;)
// &#39;/home&#39; on Linux
// &#39;/Users&#39; on OSX
// &#39;C:\\Users&#39; on Windows</code></pre>
<h2>Use <code>path.normalize</code> to create reliable paths</h2>
<p>If you find yourself doing things like this</p>
<pre><code>var filePath = &#39;/home/george/../folder/code&#39;;</code></pre>
<p>You should be using <code>path.normalize</code>. This will present you with the correct path on whatever platform you are using.</p>
<pre><code>var filePath = path.normalize(&#39;/home/george/../folder/code&#39;); 
// &#39;/home/folder/code&#39;</code></pre>
<h2>Use <code>path.join</code> to join folder names</h2>
<p>As we saw before with the string concatenation example kittens can die if you use string concatenation.</p>
<p>If you need to join paths together use <code>path.join</code>. This will also normalize the result for you.</p>
<pre><code>path.join(&#39;foo&#39;, &#39;..&#39;, &#39;bar&#39;, &#39;baz/foo&#39;);
// &#39;bar/baz/foo&#39; on OSX and Linux
// &#39;bar\\baz\\foo&#39; on Windows</code></pre>
<h2>Scripts in package.json</h2>
<p>Let&#39;s say you have the following executable script <code>npm-postinstall</code> in the bin folder of your project. </p>
<pre><code>#!/usr/bin/env node
console.log(&#39;node modules installed!&#39;);</code></pre>
<p>If you define scripts to be run in your package.json you will find that Windows will choke if you rely on a Node.js shebang.</p>
<pre><code>{
  &quot;name&quot;: &quot;some-app&quot;,
  &quot;version&quot;: &quot;0.0.1&quot;,
  &quot;authors&quot;: [
    &quot;George Ornbo &lt;george@shapeshed.com&gt;&quot;,
  ],
  &quot;scripts&quot;: {
    &quot;postinstall&quot;: &quot;./bin/npm-postinstall&quot;
  }
}</code></pre>
<p>The solution is to use the node executable.</p>
<pre><code>{
  &quot;name&quot;: &quot;some-app&quot;,
  &quot;version&quot;: &quot;0.0.1&quot;,
  &quot;authors&quot;: [
    &quot;George Ornbo &lt;george@shapeshed.com&gt;&quot;,
  ],
  &quot;scripts&quot;: {
    &quot;postinstall&quot;: &quot;node bin/npm-postinstall&quot;
  }
}</code></pre>
<p>This works for all platforms rather than just OSX and Linux.</p>
<h2>Join shell commands with a double ampersand instead of a semi-colon</h2>
<p>If you are working with any form of executing command-line programs, and you like to execute more than one in a single go, you would probably do so like this (let&#39;s use the basic act of creating a folder and cd&#39;ing into it for brevity):</p>
<pre><code>shell.exec(&#39;mkdir folder_name; cd folder_name&#39;);</code></pre>
<p>Unfortunately, that does not work on Windows. Instead, use this:</p>
<pre><code>shell.exec(&#39;mkdir folder_name &amp;&amp; cd folder_name&#39;);</code></pre>
<h2>Cross Platform Newline Characters</h2>
<p>We all know how troublesome newline characters are accross platforms. Some platforms use &#39;\n&#39;, others use &#39;\r&#39;, and the rest use both. If you are struggling to get the newline character to work in your log statements or strings on multiple platforms, then you might consider a solution that uses nasty regular expressions to match the correct newline character that you want. Usually, that would look like this: <code>/(?:\r\n|[r\n])/</code>. Yuck. Here&#39;s a better approach. The <code>OS</code> module has an <code>EOL</code> constant attached to it that when referred, will output the correct newline character for the operating system.</p>
<p>  var os = require(&#39;os&#39;),
      EOL = os.EOL;</p>
<p>  console.log(&#39;This text will print&#39; + EOL + &#39;on three lines&#39; + EOL + &#39;no matter the OS&#39;);</p>
<p>Thanks to <a href="http://declandewet.com">Declan de Wet</a> for the above two tips.</p>
<h2>Temporary files</h2>
<p>If you need to write files to a <code>tmp</code> folder use <code>os.tmpdir()</code> to ensure you write to the correct tmp file location for you platform. Thanks to <a href="https://github.com/alessioalex">alessioalex</a> for this tip. </p>
<h2>Home directories</h2>
<p>On *nix your home directory is process.env.HOME but in Windows the home directory is proces.env.HOMEPATH. You can smooth this out with</p>
<pre><code>var homedir = (process.platform === &#39;win32&#39;) ? process.env.HOMEPATH : process.env.HOME;</code></pre>
<p>The <a href="https://www.npmjs.org/package/module-smith">module-smith</a> module takes care of this for you so if you are interested in writing cross-platform modules consider using this. </p>
<p>Thanks to <a href="https://github.com/indexzero">indexzero</a> for this tip. </p>
<h2>Use the os module for more control</h2>
<p>If you need even more control you can get the operating system platform and CPU architecture you are running on react accordingly with the <a href="http://nodejs.org/api/os.html">os module</a>.</p>
<pre><code>var os = require(&#39;os&#39;);
os.platform();
// &#39;linux&#39; on Linux
// &#39;win32&#39; on Windows 32-bit
// &#39;win64&#39; on Windows 64-bit
// &#39;darwin&#39; on OSX
os.arch();
// &#39;x86&#39; on 32-bit CPU architecture
// &#39;x64&#39; on 64-bit CPU architecture</code></pre>
<h2>Conclusion</h2>
<p>One of the major strengths of Node.js is the ability to deploy your code on any platform and to work with almost any development platform. With a bit of knowledge you can make cross-platform compatibility happen out of the box and avoid having to write the &#39;make x compatible on x&#39; ticket.</p>
<h2>References</h2>
<ul>
<li><a href="http://nodejs.org/api/path.html">Core path module</a></li>
<li><a href="http://nodejs.org/api/os.html">Core os module</a></li>
<li><a href="http://dailyjs.com/2012/05/24/windows-and-node-4/">Windows and Node: Writing Portable Code</a></li>
<li><a href="https://www.npmjs.org/package/module-smith">Tips for Writing Portable Node.js Code</a></li>
</ul>
</div><p>Have an update or suggestion for this article? <a href="https://github.com/shapeshed/shapeshed.com/blob/master/src/_posts/writing-cross-platform-node.md">You can edit it here and send me a pull request.</a></p></article><footer><h2>About the author</h2><p>I'm a student at Harvard College based for the summer in New York, NY. I currently get paid to develop in Java recultantly, though I'm coming around. I speak rails and I'm about to pick up Node. </p><p>On Twitter as <a href="https://twitter.com/samlewisgreen" class="highlight">samlewisgreen</a> and GitHub as <a href="https://github.com/greensam" class="highlight">greensam</a>.</p><p> <a href="/" class="highlight">‚Üê http://samuelgreen.org</a></p></footer><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-324369-3', 'shapeshed.com');
ga('require', 'linkid', 'linkid.js');
ga('send', 'pageview');
</script><script src="/javascripts/application-cd0edf416a4508b2ef871854ce2169f2.js"></script><script>hljs.initHighlightingOnLoad();</script></body></html>